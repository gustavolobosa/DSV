@model verificable.Models.Formulario

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>Formulario</h4>
<hr />
<div class="row">
    <div class="col-md-12">

        <form asp-action="Create" method="post">
            <div class="border">
                <h4 class="box-title">Informacion de la Escritura</h4>
                <label for="cne">CNE:</label>
                <select name="Cne" class="form-control" onchange="showHideDiv()">
                    <option asp-for="Cne" value="Compraventa">Compraventa</option>
                    <option asp-for="Cne" value="Regularizacion De Patrimonio">Regularizacion de Patrimonio</option>
                </select>
            </div>

            <div class="border">
                <h4 class="box-title">Informacion de la Propiedad Enajenada</h4>
                <span class="col">
                    <label for="comuna">Comuna:</label>
                    <input type="text" id="comuna" name="comuna">
                </span>
                <span class="col">
                    <label for="manzana">Manzana:</label>
                    <input type="text" id="manzana" name="manzana">
                </span>
                <span class="col">
                    <label for="predio">Predio:</label>
                    <input type="text" id="predio" name="predio">
                </span>
             </div>

            
                <div class="border" id="enajenantes">
                    <h4 class="box-title" id="enajenantes">Informacion de los Enajenantes:</h4>
                <table id="enajenantes">
                    <thead>
                        <tr>
                            <th>Run/Rut</th>
                            <th>Porcentaje de derecho</th>
                            <th>No acreditado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input placeholder="-" type="text" name="enajenantes[0].run_rut" />
                            </td>
                            <td>
                                <input placeholder=0  type="number" step="0.01" name="enajenantes[0].porcentaje_derecho" />
                            </td>
                            <td>
                                <input placeholder=0 type="checkbox" step="0.01" name="enajenantes[0].no_acreditado" />
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger" onclick="removeEnajenantes(this)">Remove</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <button type="button" class="btn btn-primary" onclick="addEnajenantes()" id="enajenantes">Add Enajenantes</button><br><br>
            </div>
            
            <div class="border">
                <h4 class="box-title">Informacion de los Adquirientes:</h4>
                <table id="adquirientes">
                    <thead>
                        <tr>
                            <th>Run/Rut</th>
                            <th>Porcentaje de derecho</th>
                            <th>No acreditado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input placeholder="-" type="text" name="adquirentes[0].run_rut" />
                            </td>
                            <td>
                                <input placeholder=0 type="number" step="0.01" name="adquirentes[0].porcentaje_derecho" />
                            </td>
                            <td>
                                <input placeholder=0 type="checkbox" step="0.01" name="adquirentes[0].no_acreditado" />
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger" onclick="removeAdquirente(this)">Remove</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <button type="button" class="btn btn-primary" onclick="addAdquirente()">Add Adquirente</button><br><br>
            </div>

            <div class="border">
                <h4 class="box-title">Inscripcion</h4>

                <span class="col">
                    <label for="fojas">Fojas:</label>
                    <input type="number" id="fojas" name="fojas">
                </span>
                <span class="col">
                    <label for="FechaInscripcion">Fecha de Inscripción:</label>
                    <input type="date" id="FechaInscripcion" name="FechaInscripcion">
                </span>
                <span class="col">
                    <label for="NumInscripcion">Número de Inscripción:</label>
                    <input type="number" id="NumInscripcion" name="NumInscripcion">
                </span>
            </div>

            <input type="submit" value="Enviar">
        </form>

    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>

        //Para  enajenantes

        var enajenantesCount = 1;

        function addEnajenantes() {
            var enajenantesTable = document.getElementById("enajenantes").getElementsByTagName('tbody')[0];
            var newRow = enajenantesTable.insertRow(-1);

            var runRutCell = newRow.insertCell(0);
            runRutCell.innerHTML = '<input type="text" name="enajenantes[' + enajenantesCount + '].run_rut" />';

            var porcentajeCell = newRow.insertCell(1);
            porcentajeCell.innerHTML = '<input type="number" step="0.01" name="enajenantes[' + enajenantesCount + '].porcentaje_derecho" />';

            var noAcreditadoCell = newRow.insertCell(2);
            noAcreditadoCell.innerHTML = '<input type="checkbox" step="0.01" name="enajenantes[' + enajenantesCount + '].no_acreditado" />';

            var removeCell = newRow.insertCell(3);
            removeCell.innerHTML = '<button type="button" class="btn btn-danger" onclick="removeEnajenantes(this)">Remove</button>';

            enajenantesCount++;
        }

        function removeEnajenantes(button) {
            var row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        //Para adquirientes

        var adqCount = 1;

        function addAdquirente() {
            var adqTable = document.getElementById("adquirientes").getElementsByTagName('tbody')[0];
            newRow = adqTable.insertRow(-1);

            runRutCell = newRow.insertCell(0);
            runRutCell.innerHTML = '<input type="text" name="adquirentes[' + adqCount + '].run_rut" />';

            porcentajeCell = newRow.insertCell(1);
            porcentajeCell.innerHTML = '<input type="number" step="0.01" name="adquirentes[' + adqCount + '].porcentaje_derecho" />';

            noAcreditadoCell = newRow.insertCell(2);
            noAcreditadoCell.innerHTML = '<input type="checkbox" step="0.01" name="adquirentes[' + adqCount + '].no_acreditado" />';

            removeCell = newRow.insertCell(3);
            removeCell.innerHTML = '<button type="button" class="btn btn-danger" onclick="removeAdquirente(this)">Remove</button>';

            adqCount++;
        }

        function removeAdquirente(button) {
            row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        function showHideDiv() {
            var cneElement = document.getElementsByName("Cne")[0];
            var enajenantesElement = document.getElementById("enajenantes");

            console.log(cneElement.value);

            if (cneElement.value === "Regularizacion De Patrimonio") {
                enajenantesElement.style.display = "none";
            } else if (cneElement.value === "Compraventa") {
                enajenantesElement.style.display = "block";
            }

        }
    </script>
}
